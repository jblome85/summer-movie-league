<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Summer Movie Draft 2025</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 0 15px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 30px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 12px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    #cumulative_chart {
      width: 100%;
      height: 500px;
    }
  </style>
</head>
<body>

  <h1>Summer Movie Draft 2025</h1>

  <section>
    <h2>Leaderboard</h2>
    <div id="leaderboard_table">Loading leaderboard...</div>
  </section>

  <section>
    <h2>Cumulative Gross Over Time</h2>
    <div id="cumulative_chart">Loading chart...</div>
  </section>

<script>
  const summaryCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTnYWGxIRDHGb1vIHXDhuOnX3d8nULXEaFrOGmgUXWPdDfJCbp8v-Vb911xEJirIKTIj2U-N3Nwy0kS/pub?gid=1562983144&single=true&output=csv';
  const cumulativeCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTnYWGxIRDHGb1vIHXDhuOnX3d8nULXEaFrOGmgUXWPdDfJCbp8v-Vb911xEJirIKTIj2U-N3Nwy0kS/pub?gid=482616797&single=true&output=csv';

  // Render HTML table from 2D array
  function renderTable(data) {
  if (!data || !data.length) return 'No data to display.';
  let html = '<table><thead><tr>';
  data[0].forEach(h => { html += `<th>${h}</th>`; });
  html += '</tr></thead><tbody>';
  for (let i = 1; i < data.length; i++) {
    html += '<tr>';
    data[i].forEach((cell, index) => {
      // Format the 'Total Gross' and 'Avg Per Movie' columns as dollars
      if (index === 1 || index === 3) {
        const num = Number(cell);
        const formatted = isNaN(num) ? cell : num.toLocaleString('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 });
        html += `<td>${formatted}</td>`;
      } else {
        html += `<td>${cell}</td>`;
      }
    });
    html += '</tr>';
  }
  html += '</tbody></table>';
  return html;
}

  async function loadLeaderboard() {
    try {
      const res = await fetch(summaryCsvUrl);
      const text = await res.text();
      console.log('Summary CSV fetched:', text.slice(0, 200));
      const parsed = Papa.parse(text, { skipEmptyLines: true });
      console.log('Parsed Summary CSV:', parsed.data);
      document.getElementById('leaderboard_table').innerHTML = renderTable(parsed.data);
    } catch (e) {
      document.getElementById('leaderboard_table').textContent = 'Failed to load leaderboard.';
      console.error('Error loading leaderboard:', e);
    }
  }

  function drawCumulativeChart(data) {
    const dataTable = new google.visualization.DataTable();

    // Add columns: first column string (date), others numbers (players)
    dataTable.addColumn('string', data[0][0]); // Date column header
    for (let i = 1; i < data[0].length; i++) {
      dataTable.addColumn('number', data[0][i]);
    }

    // Add rows
    for (let i = 1; i < data.length; i++) {
      const row = [data[i][0]];
      for (let j = 1; j < data[i].length; j++) {
        const val = Number(data[i][j].replace(/[$,]/g, ''));
        row.push(isNaN(val) ? 0 : val);
      }
      dataTable.addRow(row);
    }

    const options = {
      title: 'Cumulative Domestic Gross by Player',
      curveType: 'function',
      legend: { position: 'bottom' },
      height: 500,
      hAxis: { title: 'Date' },
      vAxis: { title: 'Gross ($)', format: 'currency' }
    };

    const chart = new google.visualization.LineChart(document.getElementById('cumulative_chart'));
    chart.draw(dataTable, options);
    console.log('Chart drawn successfully');
  }

  async function loadAndDrawCumulativeChart() {
    try {
      const res = await fetch(cumulativeCsvUrl);
      const text = await res.text();
      console.log('Cumulative CSV fetched:', text.slice(0, 200));
      const parsed = Papa.parse(text, { skipEmptyLines: true });
      console.log('Parsed Cumulative CSV:', parsed.data);
      drawCumulativeChart(parsed.data);
    } catch (e) {
      document.getElementById('cumulative_chart').textContent = 'Failed to load chart.';
      console.error('Error loading cumulative chart:', e);
    }
  }

  // Load leaderboard right away
  loadLeaderboard();

  // Load Google Charts, then load and draw cumulative chart
  google.charts.load('current', { packages: ['corechart'] });
  google.charts.setOnLoadCallback(loadAndDrawCumulativeChart);

</script>

</body>
</html>
