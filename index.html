<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Summer Movie Draft Tracker</title>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 900px;
    }
    table {
      border-collapse: collapse;
      margin-bottom: 30px;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px 10px;
      text-align: left;
    }
    th {
      background-color: #f0f0f0;
    }
    h2 {
      margin-top: 40px;
    }
    #chart_div {
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body>

  <h1>Summer Movie Draft Tracker</h1>

  <h2>Summary Table</h2>
  <div id="summary-table"></div>

  <h2>Cumulative Totals</h2>
  <div id="cumulative-table"></div>

  <h2>Cumulative Totals Over Time (Line Chart)</h2>
  <div id="chart_div"></div>

<script>
  const summaryCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTnYWGxIRDHGb1vIHXDhuOnX3d8nULXEaFrOGmgUXWPdDfJCbp8v-Vb911xEJirIKTIj2U-N3Nwy0kS/pub?gid=1562983144&single=true&output=csv';
  const cumulativeCsvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTnYWGxIRDHGb1vIHXDhuOnX3d8nULXEaFrOGmgUXWPdDfJCbp8v-Vb911xEJirIKTIj2U-N3Nwy0kS/pub?gid=482616797&single=true&output=csv';

  // Simple CSV parser - splits by line and comma (no quoted fields handling)
  function parseCSV(text) {
    const lines = text.trim().split('\n');
    return lines.map(line => line.split(','));
  }

  // Render HTML table given 2D array data (first row as headers)
  function renderTable(data) {
    if (!data || data.length === 0) return '<p>No data to display</p>';
    let html = '<table><thead><tr>';
    data[0].forEach(header => {
      html += `<th>${header}</th>`;
    });
    html += '</tr></thead><tbody>';
    for (let i = 1; i < data.length; i++) {
      html += '<tr>';
      data[i].forEach(cell => {
        html += `<td>${cell}</td>`;
      });
      html += '</tr>';
    }
    html += '</tbody></table>';
    return html;
  }

  // Load and render both tables
  async function loadTables() {
    try {
      const summaryResp = await fetch(summaryCsvUrl);
      const summaryText = await summaryResp.text();
      const summaryData = parseCSV(summaryText);
      document.getElementById('summary-table').innerHTML = renderTable(summaryData);

      const cumulativeResp = await fetch(cumulativeCsvUrl);
      const cumulativeText = await cumulativeResp.text();
      const cumulativeData = parseCSV(cumulativeText);
      document.getElementById('cumulative-table').innerHTML = renderTable(cumulativeData);

      drawChart(cumulativeData);
    } catch (error) {
      console.error('Error loading CSV data:', error);
      document.getElementById('summary-table').textContent = 'Failed to load summary data.';
      document.getElementById('cumulative-table').textContent = 'Failed to load cumulative data.';
    }
  }

  // Draw line chart using Google Charts for cumulative totals over time
  function drawChart(cumulativeData) {
    // Assumes first row = headers: ["Date", "Jon", "Ryne", "Josh", "Dan", "Zac"]
    if (!cumulativeData || cumulativeData.length < 2) {
      document.getElementById('chart_div').textContent = 'Not enough data to plot chart.';
      return;
    }

    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(() => {
      const dataTable = new google.visualization.DataTable();

      // Add columns (Date + players)
      dataTable.addColumn('string', 'Date');
      for (let i = 1; i < cumulativeData[0].length; i++) {
        dataTable.addColumn('number', cumulativeData[0][i]);
      }

      // Add rows (parse numbers)
      const rows = [];
      for (let i = 1; i < cumulativeData.length; i++) {
        const row = [];
        row.push(cumulativeData[i][0]); // Date as string
        for (let j = 1; j < cumulativeData[i].length; j++) {
          const val = Number(cumulativeData[i][j].replace(/[^0-9.-]+/g,"")); // Remove $ or commas if present
          row.push(isNaN(val) ? 0 : val);
        }
        rows.push(row);
      }
      dataTable.addRows(rows);

      const options = {
        title: 'Cumulative Domestic Gross by Player Over Time',
        curveType: 'function',
        legend: { position: 'bottom' },
        height: 400,
        hAxis: { title: 'Date' },
        vAxis: { title: 'Gross ($)', format: 'currency' }
      };

      const chart = new google.visualization.LineChart(document.getElementById('chart_div'));
      chart.draw(dataTable, options);
    });
  }

  // Run on page load
  loadTables();
</script>

</body>
</html>
